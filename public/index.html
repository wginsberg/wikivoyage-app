<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Wikivoyage App</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚙️</text></svg>">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/protomaps@1.19.0/dist/protomaps.min.js"></script>

    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- <div id="map"></div> -->
    <!-- <script type="text/javascript">
      const MARKER_STYLE_DEFAULT = { radius:5, opacity: 0, color: 'blue', fillOpacity: 0.5, weight : 10 }
      const MARKER_STYLE_ACTIVE = { color: 'green', fillOpacity: 1 }
      const LINE_STYLE_DEFAULT = {color: 'black', opacity: 0.1}
      const LINE_STYLE_ACTIVE = {color: 'black', opacity: 0.5}

      const map = L.map('map')
      const markers = {}
      const polylines = {}

      const p = new protomaps.PMTiles("tiles.pmtiles")
      p.metadata()
      .then(m => {
          let bounds_str = m.bounds.split(',')
          let bounds = [[+bounds_str[1],+bounds_str[0]],[+bounds_str[3],+bounds_str[2]]]
          layer = protomaps.leafletLayer({attribution:'<a href="https://protomaps.com">Protomaps</a> © <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>',url:p,bounds:bounds})
          layer.addTo(map)
          map.fitBounds(bounds)
      })
      .then(() => fetch("data/mexico.json").then(res => res.json()))
      .then(({ nodes, edges }) => {
          for (edge of edges) {
              const { origin, destination } = edge
              const originLatLng = [origin.lat, origin.lng]
              const destinationLatLng = [destination.lat, destination.lng]
              const latlngs = [originLatLng, destinationLatLng];
              const polyline = L.polyline(latlngs, LINE_STYLE_DEFAULT)
              polyline.addTo(map);

              // Keep track of polyline objects for click handlers
              if (!polylines[originLatLng]) polylines[originLatLng] = new Set()
              if (!polylines[destinationLatLng]) polylines[destinationLatLng] = new Set()
              polylines[originLatLng].add(polyline)
              polylines[destinationLatLng].add(polyline)
          }

          for (node of nodes) {
              const { lat, lng } = node
              const marker = L.circleMarker([lat, lng], MARKER_STYLE_DEFAULT)
              marker.addTo(map)
              marker.on('click', onClickMarker)

              // Keep track of marker objects for click handers
              markers[[ lat, lng ]] = marker
          }

          window.nodes = nodes
          window.edges = edges
      })

      let activeMarker
      let activeLines = []
      function onClickMarker(target) {
          // Reset previous active styling
          if (activeMarker) activeMarker.setStyle(MARKER_STYLE_DEFAULT)
          for (const polyline of activeLines) {
              polyline.setStyle(LINE_STYLE_DEFAULT)
          }

          // Set marker styling
          const { lat, lng } = target.latlng
          const marker = markers[[ lat, lng ]]
          marker.setStyle(MARKER_STYLE_ACTIVE)
          activeMarker = marker

          // Set line styling
          const lines = polylines[[lat, lng]] || []
          for (const polyline of lines) {
              polyline.setStyle(LINE_STYLE_ACTIVE)
          }
          activeLines = lines

          // Set header text
          const header = document.getElementById("header")
          const node = window.nodes.find(e => e.lat === lat && e.lng === lng)
          const title = node.title
          const href = `https://en.wikivoyage.org/wiki/${title}`
          header.innerHTML = `<a href="${href}" target="_blank">${title}</a>`

      }
  </script> -->
  </body>
</html>
